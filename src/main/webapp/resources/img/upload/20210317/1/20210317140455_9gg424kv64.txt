5핀 연결 > 테라텀 >


테라텀




AT명령어 - 복사 후 테라텀에서 오른쪽버튼 > 엔터

[GW]
1) AT+MODE
2) AT+SET_GW_OID=1.2.410.200073.1.101.1.240.002.000002
2) AT+SET_GW_OID=1.2.410.200073.1.101.1.240.002.000003 v
2) AT+SET_GW_OID=1.2.410.200073.1.101.1.240.002.000008

AT+SET_GW_IPv4=192.168.0.201,255.255.255.0,192.168.0.1,192.168.0.106
AT+SET_GW_IPv4=192.168.0.201,255.255.255.0,192.168.0.1,221.144.83.86
AT+SET_GW_IPv4=117.111.23.164,255.255.255.0,192.168.0.1,221.144.83.86
AT+SET_GW_IPv4=192.168.255.21,255.255.255.0,192.168.0.1,221.144.83.86

AT+SET_RF_CH=20

AT+SET_CONFIG

[DEVICE]
AT+MODE
AT+SET_GW_OID=1.2.410.200073.1.101.1.240.002.000002
AT+SET_GW_OID=1.2.410.200073.1.101.1.240.002.000003
AT+SET_GW_OID=1.2.410.200073.1.101.1.240.002.000008

http://221.144.83.86:8080/#/clients 에서 쓰지 않는 디바이스 OID를 선택/입력

3) AT+SET_DEV_OID=1.2.410.200073.1.101.1.240.001.000039
3) AT+SET_DEV_OID=1.2.410.200073.1.101.1.240.001.000016 > > > 
3) AT+SET_DEV_OID=1.2.410.200073.1.101.1.240.001.000018
3) AT+SET_DEV_OID=1.2.410.200073.1.101.1.240.001.000401
3) AT+SET_DEV_OID=1.2.410.200073.1.101.1.240.001.000402
3) AT+SET_DEV_OID=1.2.410.200073.1.101.1.240.001.000403

4) AT+SET_RF_CH=20
ㄴ 게이트웨이 채널과 일치, 현재 20

5) AT+SET_CONFIG

6) leshan에서 디바이스 등장하는지 확인


** 포스트맨에서 테스트 **
ㄴ post 방식, body는 raw로 설정 후 입/출력 확인


7) 점등/소등 커맨드
ㄴ [POST] http://221.144.83.86:8080/api/clients/1.2.410.200073.1.101.1.240.001.001111/3311/0/5850
ㄴ OID 주의: 1.2.410.200073.1.101.1.240.001.001111 를 변경 후 조작.
ㄴ 커맨드 후 <<<터미널>>> 로그에 수치 값 확인

	** 기기 시작 **
	recvfrom[21] from (15683)FE80:0000:0000:0000:0202:4000:0200:0003 to (15683)FE80:0000:0000:0000:0202:4000:0100:0016
	OPTION 11 (delta 11, len zu): OPTION 11 (delta 0, len zu): OPTION 11 (delta 0, len zu): OPTION 12 (delta 1, len zu): Content-Format [0]
	 - CoAP V:1, T:0, To:2, C:2, MID:20396
	 - URI:3311/0/5850
	 - Payload[1]:1
	copy token:AC, 1F
	eiot_lwm2m_profile_device_SmartLamp_onoff
	recv res smart_lamp on/off : 1
	smart lamp on!

	** 기기 종료 **
	recvfrom[21] from (15683)FE80:0000:0000:0000:0202:4000:0200:0003 to (15683)FE80:0000:0000:0000:0202:4000:0100:0016
	OPTION 11 (delta 11, len zu): OPTION 11 (delta 0, len zu): OPTION 11 (delta 0, len zu): OPTION 12 (delta 1, len zu): Content-Format [0]
	 - CoAP V:1, T:0, To:2, C:2, MID:20367
	 - URI:3311/0/5850
	 - Payload[1]:0
	copy token:8F, 1F
	eiot_lwm2m_profile_device_SmartLamp_onoff
	recv res smart_lamp on/off : 0
	smart lamp off!
	eiot_coap_new_transaction[20367:120] p:15683

8) 디밍 조절
ㄴ [POST] http://221.144.83.86:8080/api/clients/1.2.410.200073.1.101.1.240.001.001111/3311/0/5851
ㄴ OID 주의: 1.2.410.200073.1.101.1.240.001.001111 를 변경 후 조작.
ㄴ 커맨드 후 <<<터미널>>> 로그에 수치 값 확인

	recvfrom[21] from (15683)FE80:0000:0000:0000:0202:4000:0200:0003 to (15683)FE80:0000:0000:0000:0202:4000:0100:0016
	OPTION 11 (delta 11, len zu): OPTION 11 (delta 0, len zu): OPTION 11 (delta 0, len zu): OPTION 12 (delta 1, len zu): Content-Format [0]
	 - CoAP V:1, T:0, To:2, C:2, MID:20361
	 - URI:3311/0/5851
	 - Payload[1]:7
	copy token:89, 1F
	eiot_lwm2m_profile_device_SmartLamp_dimmer
	recv res smart_lamp dimming val[1] :7
	smart lamp level : 7
	eiot_coap_new_transaction[20361:120] p:15683



9) 전원 차단감지
ㄴ 스위치 차단 후 로그로 확인

** 서버로깅 **

221.144.83.86 / ssh
ㄴ iot_dev
ㄴ 경로: /home/iot_dev/Leshan/log/nohup.out / 과거파일은 날짜
ㄴ 패이로드확인


** 로그로 상태 확인 **
키: 1.2.410.200073.1.101.1.240.001.005001, 값: 2021-3-11 10:3:49;440;1086;1;0;65535;-1.00;-1.00;1
client(2021-03-12 09:32:44) :: ClientReader :: /221.144.83.86:37040 :: 보낸 메세지X1 :oid1: 1.2.410.200073.1.101.1.240.001.005001
client(2021-03-12 09:32:44) :: ClientReader :: /221.144.83.86:37040 :: 보낸 메세지X1 :oid2: 1.2.410.200073.1.101.1.240.001.005001
client(2021-03-12 09:32:44) :: ClientReader :: /221.144.83.86:37040 :: 보낸 메세지X2 :: 3
client(2021-03-12 09:32:44) :: ClientReader :: /221.144.83.86:37040 :: 보낸 메세지X3 :: 2021-3-11 10:3:49;440;1086;1;0;65535;-1.00;-1.00;1
client(2021-03-12 09:32:44) :: ClientReader :: /221.144.83.86:37040 :: 보낸 메세지X4 :size: 9
client(2021-03-12 09:32:44) :: ClientReader :: /221.144.83.86:37040 :: 보낸 메세지X5 :devTime: 2021-3-11 10:3:49
client(2021-03-12 09:32:44) :: ClientReader :: /221.144.83.86:37040 :: 보낸 메세지X5 :devOffTime: 440
client(2021-03-12 09:32:44) :: ClientReader :: /221.144.83.86:37040 :: 보낸 메세지X5 :devOnTime: 1086
client(2021-03-12 09:32:44) :: ClientReader :: /221.144.83.86:37040 :: 보낸 메세지X5 :powerIssue: 1
client(2021-03-12 09:32:44) :: ClientReader :: /221.144.83.86:37040 :: 보낸 메세지X5 :lampOn: 0
client(2021-03-12 09:32:44) :: ClientReader :: /221.144.83.86:37040 :: 보낸 메세지X5 :lampIssue: 65535
client(2021-03-12 09:32:44) :: ClientReader :: /221.144.83.86:37040 :: 보낸 메세지X5 :armpare: -1.00mA
client(2021-03-12 09:32:44) :: ClientReader :: /221.144.83.86:37040 :: 보낸 메세지X5 :power: -1.00Wh
localDate :: Thu Mar 11 19:03:49 KST 2021
timeDate :: Fri Mar 12 09:32:44 KST 2021
client(2021-03-12 09:32:44) :: ClientReader :: /221.144.83.86:37040 :: 보낸 메세지 :: ![032]STS_0101@[0001][000000000][001005001] [O,X,B]


ㄴ 네트워크 상태 점검 - [O,X,B] 부분 중 첫 값이 X로 표기
client(2021-03-12 09:29:14) :: ClientReader :: /221.144.83.86:37040 :: 보낸 메세지 :: ![032]STS_0101@[0001][000000000][001000018] [O,X,B]

ㄴ 점등상태 점검 - [O,X,B] 부분 중 가운데 값이 X로 표기
client(2021-03-12 09:29:14) :: ClientReader :: /221.144.83.86:37040 :: 보낸 메세지 :: ![032]STS_0101@[0001][000000000][001000018] [O,X,B]

ㄴ 차단기(정전) 테스트 - [O,X,B] 부분 중 끝이 B로 표기
client(2021-03-12 09:29:14) :: ClientReader :: /221.144.83.86:37040 :: 보낸 메세지 :: ![032]STS_0101@[0001][000000000][001000018] [O,X,B]




AT+GET_CONFIG